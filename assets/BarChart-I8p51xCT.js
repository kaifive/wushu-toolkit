import{g as ot,s as H,b as at,d as ht,_ as N,u as dt,I as nt,e as xt,f as ut,h as yt,i as v,j as rt,k as lt,D as ft,l as Z,S as ct,C as V,m as B,n as X,o as tt,p as K,q as mt,r as gt,t as pt,v as st,w as Ct,x as bt,R as At,y as kt,z as vt,A as It,B as $t,E as wt}from"./calculatePercentage-C1SEUY01.js";import{r as I,j as r}from"./index-DoDFSqdI.js";const jt=["id","dataIndex","classes","color","highlightScope","slots","slotProps","style","onClick"];function Mt(t){return lt("MuiBarElement",t)}ot("MuiBarElement",["root"]);const Et=t=>{const{classes:s,id:i}=t,e={root:["root",`series-${i}`]};return rt(e,Mt,s)},Lt=H(at.rect,{name:"MuiBarElement",slot:"Root",overridesResolver:(t,s)=>s.root})(({ownerState:t})=>({stroke:"none",fill:t.isHighlighted?ht(t.color).brighter(.5).formatHex():t.color,transition:"opacity 0.2s ease-in, fill 0.2s ease-in",opacity:t.isFaded&&.3||1}));function Tt(t){const{id:s,dataIndex:i,classes:e,color:a,highlightScope:o,slots:h,slotProps:d,style:$,onClick:l}=t,g=N(t,jt),f=dt(o),{item:y}=I.useContext(nt),m=xt(y,{type:"bar",seriesId:s,dataIndex:i},o),x=!m&&ut(y,{type:"bar",seriesId:s,dataIndex:i},o),n={id:s,dataIndex:i,classes:e,color:a,isFaded:x,isHighlighted:m},c=Et(n),u=(h==null?void 0:h.bar)??Lt,p=yt({elementType:u,externalSlotProps:d==null?void 0:d.bar,additionalProps:v({},g,f({type:"bar",seriesId:s,dataIndex:i}),{style:$,className:c.root,onClick:l,cursor:l?"pointer":"unset"}),ownerState:n});return r.jsx(u,v({},p))}function St(){const{chartId:t}=I.useContext(ft);return I.useMemo(()=>t,[t])}const G=(t,{hasNegative:s,hasPositive:i,borderRadius:e,layout:a})=>{if(!e)return 0;const o=a==="vertical";return t==="top-left"&&(o&&i||!o&&s)||t==="top-right"&&(o&&i||!o&&i)||t==="bottom-right"&&(o&&s||!o&&i)||t==="bottom-left"&&(o&&s||!o&&s)?e:0},Pt=["style","maskId"],Rt=t=>`inset(0px round ${t.topLeft}px ${t.topRight}px ${t.bottomRight}px ${t.bottomLeft}px)`;function _t(t){var i,e;const s=t.ownerState;return r.jsx(at.rect,{style:v({},t.style,{clipPath:(t.ownerState.layout==="vertical"?(i=t.style)==null?void 0:i.height:(e=t.style)==null?void 0:e.width).to(a=>Rt({topLeft:Math.min(a,G("top-left",s)),topRight:Math.min(a,G("top-right",s)),bottomRight:Math.min(a,G("bottom-right",s)),bottomLeft:Math.min(a,G("bottom-left",s))}))})})}function zt(t){const{style:s,maskId:i}=t,e=N(t,Pt);return!t.borderRadius||t.borderRadius<=0?null:r.jsx("clipPath",{id:i,children:r.jsx(_t,{ownerState:e,style:s})})}const Dt=["skipAnimation","onItemClick","borderRadius"];function Bt({bandWidth:t,numberOfGroups:s,gapRatio:i}){if(i===0)return{barWidth:t/s,offset:0};const e=t/(s+(s-1)*i),a=i*e;return{barWidth:e,offset:a}}const Gt=()=>{const t=I.useContext(ct).bar??{series:{},stackingGroups:[],seriesOrder:[]},s=I.useContext(V),i=St(),{series:e,stackingGroups:a}=t,{xAxis:o,yAxis:h,xAxisIds:d,yAxisIds:$}=s,l=d[0],g=$[0],f={};return{completedData:a.flatMap(({ids:m},x)=>m.flatMap(n=>{const c=e[n].xAxisKey??l,u=e[n].yAxisKey??g,p=o[c],w=h[u],A=e[n].layout==="vertical";let C;if(A){if(!B(p))throw new Error(`MUI X Charts: ${c===X?"The first `xAxis`":`The x-axis with id "${c}"`} should be of type "band" to display the bar series of id "${n}".`);if(o[c].data===void 0)throw new Error(`MUI X Charts: ${c===X?"The first `xAxis`":`The x-axis with id "${c}"`} should have data property.`);if(C=p,B(w)||tt(w))throw new Error(`MUI X Charts: ${u===K?"The first `yAxis`":`The y-axis with id "${u}"`} should be a continuous type to display the bar series of id "${n}".`)}else{if(!B(w))throw new Error(`MUI X Charts: ${u===K?"The first `yAxis`":`The y-axis with id "${u}"`} should be of type "band" to display the bar series of id "${n}".`);if(h[u].data===void 0)throw new Error(`MUI X Charts: ${u===K?"The first `yAxis`":`The y-axis with id "${u}"`} should have data property.`);if(C=w,B(p)||tt(p))throw new Error(`MUI X Charts: ${c===X?"The first `xAxis`":`The x-axis with id "${c}"`} should be a continuous type to display the bar series of id "${n}".`)}const M=p.scale,S=w.scale,R=mt(e[n],o[c],h[u]),F=C.scale.bandwidth(),{barWidth:E,offset:T}=Bt({bandWidth:F,numberOfGroups:a.length,gapRatio:C.barGapRatio}),_=x*(E+T),{stackedData:Y}=e[n];return Y.map((D,j)=>{var q,J;const z=D.map(Q=>A?S(Q):M(Q)),P=Math.round(Math.min(...z)),L=Math.round(Math.max(...z)),W=e[n].stack,b={seriesId:n,dataIndex:j,layout:e[n].layout,x:A?M((q=o[c].data)==null?void 0:q[j])+_:P,y:A?P:S((J=h[u].data)==null?void 0:J[j])+_,xOrigin:M(0),yOrigin:S(0),height:A?L-P:E,width:A?E:L-P,color:R(j),highlightScope:e[n].highlightScope,value:e[n].data[j],maskId:`${i}_${W||n}_${x}_${j}`};f[b.maskId]||(f[b.maskId]={id:b.maskId,width:0,height:0,hasNegative:!1,hasPositive:!1,layout:b.layout,xOrigin:M(0),yOrigin:S(0),x:0,y:0});const k=f[b.maskId];return k.width=b.layout==="vertical"?b.width:k.width+b.width,k.height=b.layout==="vertical"?k.height+b.height:b.height,k.x=Math.min(k.x===0?1/0:k.x,b.x),k.y=Math.min(k.y===0?1/0:k.y,b.y),k.hasNegative=k.hasNegative||(b.value??0)<0,k.hasPositive=k.hasPositive||(b.value??0)>0,b})})),masksData:Object.values(f)}},U=({layout:t,yOrigin:s,x:i,width:e,y:a,xOrigin:o,height:h})=>v({},t==="vertical"?{y:s,x:i,height:0,width:e}:{y:a,x:o,height:h,width:0}),O=({x:t,width:s,y:i,height:e})=>({y:i,x:t,height:e,width:s});function Ut(t){const{completedData:s,masksData:i}=Gt(),{skipAnimation:e,onItemClick:a,borderRadius:o}=t,h=N(t,Dt),d=Z(s,{keys:l=>`${l.seriesId}-${l.dataIndex}`,from:U,leave:U,enter:O,update:O,immediate:e}),$=Z(i,{keys:l=>l.id,from:U,leave:U,enter:O,update:O,immediate:e});return r.jsxs(I.Fragment,{children:[$((l,{id:g,hasPositive:f,hasNegative:y,layout:m})=>r.jsx(zt,{maskId:g,borderRadius:o,hasNegative:y,hasPositive:f,layout:m,style:l})),d((l,{seriesId:g,dataIndex:f,color:y,highlightScope:m,maskId:x})=>{const n=r.jsx(Tt,v({id:g,dataIndex:f,color:y,highlightScope:m},h,{onClick:a&&(c=>{a(c,{type:"bar",seriesId:g,dataIndex:f})}),style:l}));return!o||o<=0?n:r.jsx("g",{clipPath:`url(#${x})`,children:n})})]})}function Ot(t){const{id:s,offset:i}=t,{left:e,top:a,width:o,height:h}=gt(),d=v({top:0,right:0,bottom:0,left:0},i);return r.jsx("clipPath",{id:s,children:r.jsx("rect",{x:e-d.left,y:a-d.top,width:o+d.left+d.right,height:h+d.top+d.bottom})})}function Xt(t){return lt("MuiChartsGrid",t)}const et=ot("MuiChartsGrid",["root","line","horizontalLine","verticalLine"]),Kt=["vertical","horizontal"],Nt=H("g",{name:"MuiChartsGrid",slot:"Root",overridesResolver:(t,s)=>[{[`&.${et.verticalLine}`]:s.verticalLine},{[`&.${et.horizontalLine}`]:s.horizontalLine},s.root]})({}),it=H("line",{name:"MuiChartsGrid",slot:"Line",overridesResolver:(t,s)=>s.line})(({theme:t})=>({stroke:(t.vars||t).palette.divider,shapeRendering:"crispEdges",strokeWidth:1})),Ft=({classes:t})=>rt({root:["root"],verticalLine:["line","verticalLine"],horizontalLine:["line","horizontalLine"]},Xt,t);function Wt(t){const s=pt({props:t,name:"MuiChartsGrid"}),{vertical:i,horizontal:e}=s,a=N(s,Kt),{xAxis:o,xAxisIds:h,yAxis:d,yAxisIds:$}=I.useContext(V),l=Ft(s),g=$[0],f=h[0],{scale:y,tickNumber:m,tickInterval:x}=o[f],{scale:n,tickNumber:c,tickInterval:u}=d[g],p=st({scale:y,tickNumber:m,tickInterval:x}),w=st({scale:n,tickNumber:c,tickInterval:u});return r.jsxs(Nt,v({},a,{className:l.root,children:[i&&p.map(({formattedValue:A,offset:C})=>r.jsx(it,{y1:n.range()[0],y2:n.range()[1],x1:C,x2:C,className:l.verticalLine},`vertical-${A}`)),e&&w.map(({formattedValue:A,offset:C})=>r.jsx(it,{y1:C,y2:C,x1:y.range()[0],x2:y.range()[1],className:l.horizontalLine},`horizontal-${A}`))]}))}function Ht(t){const{onAxisClick:s}=t,i=I.useContext(Ct),e=I.useContext(ct),{axis:a}=I.useContext(nt),{xAxisIds:o,xAxis:h,yAxisIds:d,yAxis:$}=I.useContext(V);return I.useEffect(()=>{const l=i.current;if(l===null||!s)return()=>{};const g=f=>{var u;f.preventDefault();const y=(a.x&&a.x.index)!==void 0,m=y?o[0]:d[0],x=y?a.x&&a.x.index:a.y&&a.y.index;if(x==null)return;const n={};Object.keys(e).filter(p=>["bar","line"].includes(p)).forEach(p=>{var w;(w=e[p])==null||w.seriesOrder.forEach(A=>{const C=e[p].series[A],M=y?C.xAxisKey:C.yAxisKey;(M===void 0||M===m)&&(n[A]=C.data[x])})});const c=(u=(y?h:$)[m].data)==null?void 0:u[x];s(f,{dataIndex:x,axisValue:c,seriesValues:n})};return l.addEventListener("click",g),()=>{l.removeEventListener("click",g)}},[a.x,a.y,s,e,i,h,o,$,d]),r.jsx(I.Fragment,{})}const qt=I.forwardRef(function(s,i){const{xAxis:e,yAxis:a,series:o,width:h,height:d,margin:$,colors:l,dataset:g,sx:f,layout:y,tooltip:m,axisHighlight:x,legend:n,grid:c,topAxis:u,leftAxis:p,rightAxis:w,bottomAxis:A,skipAnimation:C,borderRadius:M,onItemClick:S,onAxisClick:R,children:F,slots:E,slotProps:T,loading:_}=s,D=`${bt()}-clip-path`,j=y==="horizontal"||y===void 0&&o.some(L=>L.layout==="horizontal"),z={scaleType:"band",data:Array.from({length:Math.max(...o.map(L=>(L.data??g??[]).length))},(L,W)=>W)},P=v({},j?{y:"band"}:{x:"band"},x);return r.jsxs(At,{ref:i,series:o.map(L=>v({type:"bar"},L,{layout:j?"horizontal":"vertical"})),width:h,height:d,margin:$,xAxis:e??(j?void 0:[v({id:X},z)]),yAxis:a??(j?[v({id:K},z)]:void 0),colors:l,dataset:g,sx:f,disableAxisListener:(m==null?void 0:m.trigger)!=="axis"&&(x==null?void 0:x.x)==="none"&&(x==null?void 0:x.y)==="none"&&!R,children:[R&&r.jsx(Ht,{onAxisClick:R}),c&&r.jsx(Wt,{vertical:c.vertical,horizontal:c.horizontal}),r.jsxs("g",{clipPath:`url(#${D})`,children:[r.jsx(Ut,{slots:E,slotProps:T,skipAnimation:C,onItemClick:S,borderRadius:M}),r.jsx(kt,{loading:_,slots:E,slotProps:T})]}),r.jsx(vt,{topAxis:u,leftAxis:p,rightAxis:w,bottomAxis:A,slots:E,slotProps:T}),r.jsx(It,v({},n,{slots:E,slotProps:T})),r.jsx($t,v({},P)),!_&&r.jsx(wt,v({},m,{slots:E,slotProps:T})),r.jsx(Ot,{id:D}),F]})});export{qt as B};
